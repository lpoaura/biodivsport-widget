<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Biodiv-Sport Widget</title>
    <meta name="description" content="biodiv-sport Widget">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="LPO AuRA">

    <link rel="stylesheet" href="assets/leaflet.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css"
        integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
    <style>
        #map {
            height: 100vh;
        }
    </style>

</head>

<body>
    <div id="map"></div>
    <script src="assets/leaflet.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        var map = L.map('map').setView([46, 6], 8);
        L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        function getApiUrl() {
            url = new URL(window.location.href);
            qs=url.search;
            apiUrl = qs.replace("?apiUrl=","");
            return apiUrl
        };
        console.log(getApiUrl());
        function loadGeoData() {
            axios
                .get(
                    getApiUrl()
                )
                .then(response => {
                    var geoJsonDatas = L.geoJSON(response.data).bindPopup(function (layer) {
                        return '<strong>elevation</strong> :'+layer.feature.properties.description +'<br>'+ 'description'+layer.feature.properties.description;
                        console.log(layer.feature.properties)
                    });
                    console.log('Hey Ho');
                    map.addLayer(geoJsonDatas);
                    bounds = geoJsonDatas.getBounds();
                    map.fitBounds(bounds);

                })
                .catch(function (error) {
                    console.log(error);
                });
        };
        loadGeoData();
    </script>